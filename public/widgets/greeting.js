import{t as Z,a as J,r as o,u as F,j as e,g as K,R as ee,P as te,A as ae,c as re}from"./styles.js";import{c as x,i as oe,s as se,C as R,a as T}from"./utils.js";const ne=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],le=x("shield",ne);const ie=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],ce=x("sparkles",ie);const de=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]],me=x("sword",de);const ue=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],he=x("wand-sparkles",ue);function pe({name:a,adventureType:r,location:l}){return console.log({name:a,adventureType:r,location:l}),`
You are the CityQuest Game Master, a playful, curious, and insightful guide who leads players on real-world adventures through their city ‚Äî like a Dungeon Master in Dungeons & Dragons, but grounded in the real world.

Your core goals:

Guide ${a}, the player, through a city-based quest, one step at a time. They have chosen to embark on an ${r} adventure which ${r==="tour"?"Should take the player through main tourist attractions and landmarks of the city. suggest 3 to 5 locations for the player to visit. should be a mix of historical, cultural, and natural landmarks.":r==="foodie"?"Should take the player through the best food and drink spots in the city. suggest 3 to 5 locations for the player to visit. should be a mix of restaurants, cafes, bars, and other food and drink establishments. Ask the player where they want to go next and offer a couple of options to choose from and adjust the adventure based on their choice.":"Should take the player through a race to visit the most iconic landmarks of the city within a given time limit. Ask the player where they want to go next and offer a couple of options to choose from and adjust the adventure based on their choice."}. They are currently at ${l}.

Ask the player where they want to go next and offer a couple of options to choose from and adjust the adventure based on their choice.

Upon arrival, challenge them with a question that tests observation, curiosity, or local knowledge.

If they answer correctly, reward them using the update-score tool.

At any point, optionally offer fun facts or local history ‚Äî like a quirky, knowledgeable tour guide.

Gameplay loop:

Offer a single prompt at a time ‚Äî a destination or activity with a playful or mysterious tone.

Wait for confirmation that the player has arrived. After arrival, use the take-picture tool to take a picture of the player at the location.

Pose a question that requires them to look, ask, or think.

Score the result, celebrate wins, and move the story forward.

Add twists, surprises, and narrative flavor if appropriate (e.g. ‚ÄúYou've found the old fountain said to grant wishes‚Ä¶‚Äù).

At the end of the adventure, use the video-summary tool to generate a video summary of the adventure.

Tone:

Friendly, imaginative, and responsive.

Blend storytelling with real-world relevance.

Encourage exploration, creativity, and delight.

Always stay in character as the CityQuest Game Master.
`}function U(a,r){const l={get(n,i){if(typeof i=="string"){const m=[...r,i];return U(a,m)}else if(i===Z){if(r.length<1){const m=[a,...r].join(".");throw new Error(`API path is expected to be of the form \`${a}.childComponent.functionName\`. Found: \`${m}\``)}return"_reference/childComponent/"+r.join("/")}else return}};return new Proxy({},l)}const be=()=>U("components",[]),G=J;be();const q=[{id:"tour",title:"Skyline Tour",accent:"from-purple-600/40 to-amber-600/20 text-purple-950",emoji:"üß≠"},{id:"foodie",title:"Mythic Foodie",accent:"from-amber-500/50 to-yellow-600/30 text-amber-950",emoji:"üçù"},{id:"race",title:"Skyway Race",accent:"from-stone-600/40 to-amber-700/30 text-stone-950",emoji:"üèÅ"}],fe=2*1024*1024,z=["Explorer","Pathfinder","Chronicle","Navigator"],L=["Lumen","Starling","Wander","Morrow","Solstice"],ge=()=>{const a=z[Math.floor(Math.random()*z.length)],r=L[Math.floor(Math.random()*L.length)];return`${a} ${r}`};let N=null;const xe=async()=>(N||(N=(async()=>{const a=await fetch("https://city-quest.netlify.app/cityquest-gamecard.png");if(!a.ok)throw new Error("Failed to fetch game card image");const r=await a.blob();return new File([r],"cityquest-gamecard.png",{type:r.type})})()),N);function ye(){const[a,r]=o.useState(0);return o.useEffect(()=>{const l=setInterval(()=>{r(n=>n>=95?n:n+Math.random()*10)},300);return()=>clearInterval(l)},[]),e.jsxs("div",{className:"relative flex min-h-[220px] w-full flex-col items-center justify-center overflow-hidden rounded-2xl border-2 border-amber-600/40 bg-gradient-to-br from-amber-950/60 via-stone-900/80 to-amber-950/60 p-8 shadow-2xl",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-20 -left-20 h-40 w-40 rounded-full bg-amber-500/20 blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-20 -right-20 h-40 w-40 rounded-full bg-yellow-500/20 blur-3xl animate-pulse",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 h-32 w-32 -translate-x-1/2 -translate-y-1/2 rounded-full bg-purple-500/10 blur-2xl animate-pulse",style:{animationDelay:"0.5s"}})]}),e.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-6 mb-6",children:[e.jsx(le,{className:"h-8 w-8 text-amber-400 animate-bounce",style:{animationDelay:"0s",animationDuration:"2s"}}),e.jsx(he,{className:"h-10 w-10 text-yellow-400 animate-spin",style:{animationDuration:"3s"}}),e.jsx(me,{className:"h-8 w-8 text-amber-400 animate-bounce",style:{animationDelay:"1s",animationDuration:"2s"}})]}),e.jsxs("div",{className:"relative z-10 text-center space-y-2 mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-amber-200 drop-shadow-lg",children:"Forging Your Character Card"}),e.jsx("p",{className:"text-sm text-amber-300/80",children:"The guild artisans are crafting your legend..."})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-xs",children:[e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-amber-900/50 border border-amber-700/30",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-500 via-yellow-500 to-amber-500 transition-all duration-300 ease-out shadow-lg shadow-amber-500/50",style:{width:`${Math.min(a,95)}%`}})}),e.jsx("div",{className:"mt-2 text-center",children:e.jsxs("span",{className:"text-xs font-semibold text-amber-300",children:[Math.round(Math.min(a,95)),"%"]})})]}),e.jsx("div",{className:"pointer-events-none absolute inset-0",children:Array.from({length:6}).map((l,n)=>e.jsx("div",{className:"absolute h-1 w-1 rounded-full bg-amber-400 animate-ping",style:{left:`${20+n*15}%`,top:`${30+n%3*20}%`,animationDelay:`${n*.3}s`,animationDuration:"2s"}},n))})]})}function ve(){const[a,r]=o.useState(()=>ge()),[l,n]=o.useState(!1),[i,m]=o.useState("tour"),[k,y]=o.useState(null),[v,C]=o.useState(null),[W,w]=o.useState(!1),[Ne,S]=o.useState(null),[h,p]=o.useState("idle"),[D,c]=o.useState(""),[M,E]=o.useState(null),[H,A]=o.useState(!1),_=o.useRef(null),I=o.useId(),Q=F(G.games.createGame),Y=F(G.games.sendPrompt),d=a.trim()||"Explorer";o.useEffect(()=>{oe()},[]);const P=q.find(t=>t.id===i);o.useMemo(()=>({title:`Welcome, ${d}!`,subtitle:`${P?.title??"CityQuest Path"} awaits.`,signature:"CityQuest Dispatch",accentColor:"#0f172a",mood:"celebrate",inlineStyles:!0}),[P?.title,d]);const u=o.useCallback(()=>{S(null),p("idle"),c("")},[]),b=o.useCallback(async t=>{A(!0),c("");try{const s=await xe(),f=new FormData;f.append("image1",t),f.append("image2",s),f.append("prompt",`Take the person from the first uploaded image and place them into the headshot area of the character card in the second image. Make sure the portrait fits naturally within the empty frame or designated area of the card design.

Preserve the fantasy/Dungeons & Dragons‚Äìstyle aesthetic of the card.

At the bottom of the card, add the text:

Player: ${d}

Match the card's existing typography and color style.`);const $=await fetch("https://imageplustexttoimage.mcp-ui-flows-nanobanana.workers.dev/api/combine-images",{method:"POST",body:f});if(!$.ok)throw new Error("Failed to combine images");const g=await $.json();if(g.success&&g.imageData){const X=`data:${g.mimeType??"image/png"};base64,${g.imageData}`;E(X)}else throw new Error("Image combination failed")}catch(s){console.error("Error combining images:",s),c(s instanceof Error?s.message:"Failed to create character card. Please try again.")}finally{A(!1)}},[d]);o.useEffect(()=>{v&&l&&b(v)},[d,v,l,b]);const j=o.useCallback(async t=>{if(!t)return;if(!t.type.startsWith("image/")){c("Choose an image to represent your adventurer.");return}if(t.size>fe){c("Please choose an image smaller than 2 MB.");return}c(""),C(t);const s=new FileReader;s.onload=()=>{typeof s.result=="string"&&(y(s.result),u(),b(t))},s.readAsDataURL(t)},[u,b]),B=o.useCallback(t=>{t.preventDefault(),w(!1);const s=t.dataTransfer.files?.[0];j(s)},[j]),V=o.useCallback(async()=>{if(h!=="saving"){p("saving"),c(""),S(null);try{console.log({displayName:d,selectedAdventure:i});const t=pe({name:d,adventureType:i,location:"London"});console.log({prompt:t}),se("prompt",{prompt:t}),p("success")}catch(t){console.error(t),c(t instanceof Error?t.message:"Unable to start your CityQuest. Please try again."),p("error")}}},[k,Q,d,i,Y,h]);return e.jsx("div",{className:"min-h-[calc(100vh-5rem)] bg-gradient-to-b from-purple-950 via-amber-950 to-stone-950 py-12 text-white",children:e.jsx("div",{className:"mx-auto flex w-full max-w-4xl justify-center px-6",children:e.jsxs("section",{className:"w-full max-w-2xl space-y-6 rounded-3xl border border-amber-800/20 bg-amber-950/20 p-8 shadow-2xl backdrop-blur",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-amber-700/30 bg-gradient-to-br from-amber-600/30 via-yellow-700/20 to-stone-800/90 p-8 shadow-inner",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 opacity-60",children:[e.jsx("div",{className:"absolute -top-10 -right-6 h-40 w-40 rounded-full bg-amber-400/40 blur-3xl"}),e.jsx("div",{className:"absolute top-12 -left-10 h-32 w-32 rounded-full bg-yellow-500/30 blur-2xl animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(255,215,0,0.2),_transparent_55%)]"})]}),e.jsx("div",{className:"relative z-10 space-y-4 text-center",children:e.jsx("h1",{className:"text-6xl font-black uppercase tracking-[0.25em] text-white drop-shadow-[0_8px_30px_rgba(217,119,6,0.55)]",children:"CityQuest"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-amber-100",htmlFor:I,children:"What should the guild call you?"}),e.jsx("input",{id:I,className:"w-full rounded-2xl border border-amber-700/30 bg-amber-950/20 px-4 py-3 text-base text-white placeholder:text-amber-200/60 focus:border-amber-400 focus:outline-none",value:a,onFocus:()=>{l||(r(""),n(!0),u())},onChange:t=>{r(t.target.value),n(!0),u()}})]}),e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"mx-auto max-w-md",children:M?e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border-2 border-amber-600/40 bg-amber-950/30 p-2 shadow-2xl",children:[e.jsx("img",{src:M,alt:"Character card",className:"mx-auto w-full max-w-full rounded-xl object-contain shadow-lg"}),e.jsx("button",{type:"button",onClick:()=>{E(null),y(null),C(null),u()},className:"absolute top-3 right-3 rounded-full bg-amber-900/80 p-2 text-amber-200 hover:bg-amber-800/90 transition",title:"Upload a different image",children:e.jsx(R,{className:"h-4 w-4"})})]}):H?e.jsx(ye,{}):e.jsxs("button",{type:"button",onDragOver:t=>{t.preventDefault(),w(!0)},onDragLeave:()=>w(!1),onDrop:B,onClick:()=>_.current?.click(),className:T("flex min-h-[180px] w-full cursor-pointer flex-col items-center justify-center gap-3 rounded-3xl border-2 border-dashed border-amber-700/40 bg-amber-950/30 p-6 text-center transition",W&&"border-amber-400/80 bg-amber-300/20"),children:[e.jsx("div",{className:"rounded-full bg-amber-800/30 p-3 text-amber-100",children:e.jsx(R,{className:"h-6 w-6"})}),e.jsx("p",{className:"text-sm text-amber-100",children:"Drag & drop or tap to upload"}),e.jsx("p",{className:"text-xs text-amber-200/80",children:"Supports live camera capture on mobile"}),e.jsx("input",{ref:_,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:t=>{j(t.target.files?.[0]),t.target.value=""}})]})})}),e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:q.map(t=>{const s=t.id===i;return e.jsxs("button",{type:"button",onClick:()=>{m(t.id),u()},className:T("group relative overflow-hidden rounded-3xl border-2 px-5 py-6 text-left transition hover:-translate-y-1 hover:border-amber-400",s?"border-amber-400 bg-amber-900/30 shadow-xl shadow-amber-600/40":"border-amber-800/20 bg-amber-950/20"),children:[e.jsx("div",{className:`absolute inset-0 opacity-70 blur-xl transition group-hover:opacity-90 ${t.accent}`,children:"¬†"}),e.jsxs("div",{className:"relative z-10 flex flex-col gap-3",children:[e.jsx("span",{className:"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-amber-800/40 text-2xl",children:t.emoji}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-white",children:t.title}),e.jsx("p",{className:"text-xs text-amber-100/80",children:s?"Selected":"Tap to begin"})]})]})]},t.id)})})}),D&&e.jsx("p",{className:"rounded-2xl border border-red-700/60 bg-red-900/20 px-4 py-3 text-sm text-red-200",children:D}),e.jsxs("button",{type:"button",onClick:()=>void V(),disabled:h==="saving",className:"group flex w-full items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-amber-500 to-yellow-600 px-6 py-4 text-lg font-bold text-amber-950 shadow-lg shadow-amber-900/50 transition hover:from-amber-400 hover:to-yellow-500 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx(ce,{className:"h-5 w-5"}),h==="saving"?"Gathering Guild Scrolls...":"Start Game"]})]})})})}const O="tanstack-app-root";function we(){const a=document.getElementById(O);if(!a)throw new Error(`Container #${O} not found`);let r=a._reactRoot;return r||(r=re.createRoot(a),a._reactRoot=r),r}function je(){const a=K();we().render(e.jsx(ee.StrictMode,{children:e.jsx(te,{...a,children:e.jsx(ae,{children:e.jsx(ve,{})})})}))}je();
